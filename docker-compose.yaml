version: '3.8'

services:
  gpt-sovits:
    image: gpt-sovits-infer:latest
    container_name: miku-voice-backend
    restart: unless-stopped
    ports:
      - "9880:9880"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      # 1. 挂载基础预训练模型 (BERT 等)
      # 请确保宿主机该目录下有 s1bert25hz-2kh-longer-epoch=68e-step=50232.ckpt 等文件
      - XXX:/app/GPT_SoVITS/pretrained_models
      
      # 2. 挂载微调后的模型 (Miku 的权重)
      # 存放您的 .ckpt (GPT) 和 .pth (SoVITS) 文件
      - XXX:/app/custom_weights
      
      # 3. 挂载参考音频 (Ref Audio)
      # 存放 miku_ref.wav 等
      - XXX:/app/ref_audio
    
    environment:
      # 如果需要调整显存分配策略，可在此添加 PyTorch 环境变量
      - CUDA_VISIBLE_DEVICES=0
